# Environment Variables & Connection Details for Render

## ğŸ”‘ Environment Variables You'll Set in Render

When you create the PostgreSQL database and backend service on Render, you'll need these environment variables:

### For Backend Service (survey-backend)

```
NODE_ENV=production
PORT=10000
DATABASE_URL=<you'll get this from PostgreSQL database>
CORS_ORIGIN=*
```

### For PostgreSQL Database

**In Render Dashboard:**
1. Create a new PostgreSQL database
2. Render will automatically provide you with connection strings
3. Copy the **"Internal Database URL"** (this is what you use for DATABASE_URL)

---

## ğŸ“ DATABASE_URL Format

PostgreSQL connection strings look like this:

```
postgresql://username:password@host:port/database
```

### Example (what Render will generate):
```
postgresql://survey_admin:a8xK9pL2mN5q@dpg-abc123def456.render.internal:5432/survey_db
```

**Breaking it down:**
- `postgresql://` - Database type
- `survey_admin` - Username (auto-generated by Render)
- `a8xK9pL2mN5q` - Password (auto-generated by Render)
- `dpg-abc123def456.render.internal` - Internal host (only Render services can use this)
- `5432` - PostgreSQL port (always 5432)
- `survey_db` - Database name

---

## ğŸŒ Service URLs

### Backend Service URL

Your Render will give you a URL like:
```
https://survey-backend-ktjp.onrender.com
```

**Full API URLs will be:**
```
https://survey-backend-ktjp.onrender.com/api/health
https://survey-backend-ktjp.onrender.com/api/survey/user
https://survey-backend-ktjp.onrender.com/api/survey/submit
https://survey-backend-ktjp.onrender.com/api/survey/response/:id
```

### Frontend API Calls

Your frontend (`/frontend/src/utils/api.js`) already has:
```javascript
const API_URL = 'https://survey-backend-ktjp.onrender.com/api';
```

This will automatically work! âœ…

---

## ğŸ“‹ Step-by-Step: Getting Your Environment Variables

### Step 1: Create PostgreSQL Database

1. Go to https://dashboard.render.com
2. Click **"New +"** button
3. Select **"PostgreSQL"**
4. Fill in:
   - **Name**: `survey_db` (can be anything)
   - **Database**: `survey_db`
   - **User**: (leave default - Render auto-generates)
   - **Plan**: Choose **Free** tier
   - **Region**: Choose your region
5. Click **"Create Database"**
6. Wait for status to show **"Available"** âœ…

### Step 2: Copy Your DATABASE_URL

Once created, you'll see the database details. Look for:
- **"Internal Database URL"** - Copy this!
- This is the `DATABASE_URL` you need

Example:
```
postgresql://survey_admin:a8xK9pL2mN5q@dpg-abc123def456.render.internal:5432/survey_db
```

### Step 3: Update Backend Service Environment

1. Go to https://dashboard.render.com/services
2. Click your **"survey-backend"** service
3. Click **"Settings"** (on the left)
4. Scroll to **"Environment"** section
5. Click **"Add Environment Variable"** for each:

| Key | Value |
|-----|-------|
| `NODE_ENV` | `production` |
| `PORT` | `10000` |
| `DATABASE_URL` | *Paste the PostgreSQL URL from Step 2* |
| `CORS_ORIGIN` | `*` |

6. Click **"Save Changes"**

---

## âœ… Verification URLs

### Health Check Endpoint
```bash
curl https://survey-backend-XXXX.onrender.com/api/health
```

**Expected Response (before database connection):**
```json
{
  "status": "Server is running",
  "environment": "production",
  "database": "disconnected"
}
```

**Expected Response (after database connection):**
```json
{
  "status": "Server is running",
  "environment": "production",
  "database": "connected",
  "databaseType": "postgresql",
  "timestamp": "2025-10-23T..."
}
```

### Test Creating a User
```bash
curl -X POST https://survey-backend-XXXX.onrender.com/api/survey/user \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "age": 25,
    "institution": "university",
    "institutionName": "Test University",
    "gmail": "test@example.com"
  }'
```

**Expected Response:**
```json
{
  "success": true,
  "userId": "clh4xyz..."
}
```

---

## ğŸ” Where to Find These Values in Render Dashboard

### PostgreSQL Database Page
```
Dashboard â†’ Your Database Name â†’ "Internal Database URL"
                                â†’ Copy the connection string
```

### Backend Service Page
```
Dashboard â†’ Services â†’ survey-backend â†’ Settings â†’ Environment
                                        â†“
                                   Add/Edit variables here
```

### Service URL
```
Dashboard â†’ Services â†’ survey-backend â†’ Top of page shows:
            "https://survey-backend-XXXX.onrender.com"
```

---

## ğŸ“Œ Important Notes

1. **Internal vs External URL**
   - Use "**Internal Database URL**" for backend service (same Render infrastructure)
   - External URL is only for outside connections
   - Internal is faster and more secure âœ…

2. **Environment Variables are Automatically Loaded**
   - Render reads `.env` values you set in dashboard
   - Your code accesses via `process.env.DATABASE_URL`
   - No need to manually create `.env` file on Render

3. **Port 10000**
   - Render requires web services to listen on port 10000
   - That's why we set `PORT=10000` in environment
   - Don't change this!

4. **CORS_ORIGIN**
   - Set to `*` to allow any frontend to connect
   - You could restrict this to your frontend domain later

---

## ğŸš€ Quick Reference Checklist

- [ ] PostgreSQL database created on Render
- [ ] Copied Internal Database URL
- [ ] Backend service has `NODE_ENV=production`
- [ ] Backend service has `PORT=10000`
- [ ] Backend service has `DATABASE_URL=<your connection string>`
- [ ] Backend service has `CORS_ORIGIN=*`
- [ ] Saved all environment variables
- [ ] Service is showing "Live" status
- [ ] Health endpoint returns `"database": "connected"`

---

## ğŸ“ If You Get Errors

**Error: "Cannot connect to database"**
- Check DATABASE_URL is set correctly in Render dashboard
- Make sure PostgreSQL database status shows "Available"
- Wait 30 seconds after saving environment variables

**Error: "Port not listening"**
- Make sure PORT=10000 in environment
- Don't set it to 5000 on Render!

**Error: "Module not found"**
- Render is rebuilding - wait 2-3 minutes
- Check build logs for actual errors

Need help? Let me know! ğŸ¯
